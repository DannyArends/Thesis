\chapter{Phenotypes and Genotypes}

\emph{Using prior knowledge about phenotypes and how they arise / mix in sexual reproduction allows us 
to saturate existing genetic maps or create them de-novo when enough data is available. Using a sensitive 
pre-selection and mixture modeling approach the resolution of the genetic map of A. thaliana was improved.}

\null
\vfill

\begin{myexampleblock}{Under review:}
  \authors{Konrad Zych*, K. Joeri van der Velde, Ronny V. L. Joosen, Wilco Ligterink, Ritsert C Jansen and Danny Arends}\\
  \emph{Pheno2Geno - High throughput generation of genetic markers and maps from molecular phenotypes}\\
  \bold{BMC Bioinformatics} (2013)
\end{myexampleblock}
\newpage

\section{Pheno2Geno}
Genetic markers and maps are instrumental for quantitative trait locus (QTL) mapping in segregating 
populations. The resolution of QTL localisation depends on the number of informative recombinations 
in the population and how well these recombinations are tagged by markers. Thus larger populations 
and denser marker maps perform better at detecting and locating QTLs. In practice, marker maps are 
often still too sparse. However, maps can be saturated or even be derived \emph{de-novo} from high-
throughput omics data, such as gene expression, protein or metabolite abundance data. This is because 
molecular phenotypes are influenced by genetic variation and they will show a clear multimodal 
distribution due to major QTL effects, such information can therefore be converted into useful 
genetic markers.

The Pheno2Geno R package is developed for high-throughput generation of genetic markers and maps from 
molecular phenotypes. Pheno2Geno selects suitable phenotypes that show clear differential expression 
in the founders. Pheno2Geno uses mixture modelling to select phenotypes showing segregation ratios 
close to the expected mendelian segregation ratios and transform them into genetic markers suitable 
for map construction and/or saturation. Pheno2Geno analyses the candidate genetic markers and excludes 
those showing multiple QTL, epistatically interacting QTL, and QTL by environment interactions to 
provide a set of robust markers for QTL mapping protecting against genetic markers from a non genetic 
origin.

We demonstrate our tool using gene expression data of 370.000 transcripts in 164 \emph{A. thaliana} 
Recombinant Inbred Lines (RILs). Pheno2Geno is able to saturate the existing genetic map decreasing 
the average distance between markers from 7.1 cM to 0.89 cM, close to the theoretical limit of 0.6 cM, 
pinpointing almost all of the informative recombinations in the population. Pheno2Geno is also able 
to created a \emph{de-novo} map from the gene expression data that is twice as dense as the original 
genetic map.

The Pheno2Geno package offers high-throughput \emph{de-novo} map construction and saturation of 
existing genetic maps. Processing of the showcase dataset takes less than 30 minutes on an average 
desktop PC. Pheno2Geno improves QTL mapping results at no additional laboratory cost and with 
minimum computational effort. Pheno2Geno results are formatted for direct use in R/qtl, the leading 
R package for QTL studies. Pheno2Geno is freely available on CRAN under GNU GPL version 3.

\subsection{Pheno2Geno - Background}
QTL mapping \cite{Lander:1989} is a powerful approach used in population analysis to link genetic 
variation to phenotypic variation between individuals. It requires polymorphic genetic markers 
positioned on a genetic map. Here we present Pheno2Geno, an R package to select and convert 
high-throughput phenotypes with major QTL into additional genetic markers, even when tens of 
thousands of molecular phenotypes (e.g. gene expression) are available, and then uses these markers 
to saturate a known genetic map.

Previously, gene expression data was used to derive genetic markers in an \emph{A. thaliana} RIL 
population \cite{West:2006} and a \emph{L. sativa} RIL population \cite{Truco:2013}. This work was 
only focussed only on RIL transcriptomics data, while Pheno2Geno is capable of handling any type 
of omics data and more cross types (backcross (BC), recombinant inbred lines (RIL) by selfing and 
sibling mating and F2 intercross). In addition, the method used \cite{West:2006, Truco:2013} is a 
simple method for genotype calling that works only for dichotome data, while Pheno2Geno uses 
statistical mixture models, posterior probabilities for genotype calling and error control that 
works for continuous data distributions\cite{Jansen:1993, Jansen:2001b}. 

In order to facilitate transition into the QTL mapping phase of the analysis, Pheno2Geno has 
output structures compatible with R/qtl, the leading R package for QTL analysis in segregating 
populations \cite{Broman:2003, Arends:2010}. The package also provides an option to output maps as 
GFF formatted file. The GFF file format is supported by most genome browsers, allowing users to 
use their favourite genome browser to explore and/or compare resulting maps (Fig. 4).

\subsection{Pheno2Geno - Features}
Pheno2Geno provides the following functionality for constructing and/or saturating genetic maps:

{\bf 1) Preprocessing of the data}: \emph{(optional)} 
Pheno2Geno offers a selection of data transformation functions (including: log, sqrt, reciprocal, 
probit and logit). Depending on the type of input data provided, the user can select a 
pre-processing step, e.g. gene expression data measured using microarrays are generally log 
\cite{Quackenbush:2002} or square root \cite{Jansen:2001b, Gort:2010} transformed before further 
analysis. R already provides packages for pre-processing and data normalization. However 
Pheno2Geno provides these methods such that they can be used 'on the fly' and further decrease 
memory usage of the algorithm.

{\bf 2) Analysis of parental data}: \emph{(optional)} 
When parental data are available Pheno2Geno can pre-select phenotypes for analysis. Pheno2Geno 
will use a \emph{t}-test to select molecular phenotypes showing significant phenotypic differences 
between the inbred parental strains, to reduce the computational load in the follow up analysis. 
By being more restrictive Pheno2Geno keeps only the phenotypes with the most significant differences 
between the parents for further analysis. This again reduces the computational burden of the 
analysis.

{\bf 3) Analysis of segregating populations}:
Phenotypes with major QTL will show clear multimodal distributions in the segregating population. 
We fit a mixture model to the phenotype distribution \cite{Jansen:1993, Jansen:2001b, Benaglia:2009}. 
Phenotypes are selected as candidate markers, only when significant multimodality and mixing 
proportions close to the expected segregation frequency are observed, e.g. 1:1 for a bimodal 
distribution of two homozygous classes in a RIL; 1:2:1 for a trimodal distribution of two homozygous 
and one heterozygous class in an F2 cross.

{\bf 4) Assigning genotypes}:
Posterior probabilities of belonging to an underlying component distributions in the mixture are 
calculated for each component \cite{Jansen:2001b, Benaglia:2009}. Using the posterior probabilities 
the continuous phenotype values are converted into discrete data (e.g. 0 or 1 for RILs; 0, 1 or 2 
for F2). If parental data are available, Pheno2Geno uses the direction of the difference in the 
parental data to convert these discrete data into marker genotype data with a parental origin 
label (A or B for RILs, A, H or B for F2). If the posterior probability for a specific marker / 
individual combination is lower than a user-specified threshold, a missing value (*) or partly 
informative value (e.g. not A, but homozygous B or heterozygous H) is assigned to avoid introducing 
genotyping errors.

{\bf 5) Environment and epistasis}: 
West et al. \cite{West:2007} highlighted some central issues when generating genetic markers from 
gene expression data: 1) The influence of environmental interactions on gene expression and 2) The 
influence of multiple QTL and epistatic interactions between two genetic loci. When information 
about the environment is available, Pheno2Geno will either flag or remove markers affected by 
environment using a user defined significance threshold. Pheno2Geno performs interval mapping (using 
the R/qtl \emph{scanone} function) on the molecular phenotypes to find the best locations for the 
candidate markers. Additionally Pheno2Geno tests if candidate markers are affected by multiple QTLs 
or if they show an epistatic interaction. Depending on the user these are also flagged or removed 
from further analysis.

{\bf 6) Saturation of a known map}:
Pheno2Geno saturates a known map by placing all candidate markers at their most likely genetic 
positions and re-estimating the map distances. Duplicate candidate markers and markers located 
at the exact position of a known marker are removed before saturating the genetic map.

{\bf 6) \emph{De-novo} construction of genetic maps}: 
When no initial map is available, Pheno2Geno can be used to create an initial 'skeleton' map. 
This skeleton map is produced using very strict settings in the mixture model analysis to obtain 
a limited number of highly thrustworthy markers, which are assigned to linkage groups by using 
the R/qtl function \emph{formLinkageGroups}. Additional information provided by the user can be 
used in this step, e.g. known physical and/or genetic positions will be used by Pheno2Geno to 
assign physical chromosome IDs to linkage groups, and to determine the correct orientation of 
chromosomes. Then Pheno2Geno orders all the markers inside a linkage group by using the R/qtl 
\emph{orderMarkers} function. As a final step the skeleton map is saturated to improve resolution 
following the procedure outline above.

{\bf 7) Detection of errors}: \emph{(optional)}
After saturation or \emph{de-novo} construction of a genetic map, Pheno2Geno will detect and 
correct any genotyping errors (double recombinations, missing data, semi informative markers) 
using the R/qtl function \emph{fill.geno}. Furthermore when saturating a known map with available 
genotype data, Pheno2Geno is able to detect sample mix-ups in the original data using R/lineup 
(which is part of the R/qtl toolset). Users can also use external tools like MixupMapper \cite{Westra:2011} 
beforehand to detect and correct the original genotype data.

\subsection{Pheno2Geno - Results}
The original AFLP map created using a population of 420 RILs derived from a cross \emph{Arabidopsis 
thaliana} Bayreuth (Bay-0) x Shahdara (Sha) \cite{Loudet:2002} contains 69 AFLP markers at an 
average map distance of 7.1 cM also derived using mixture models \cite{Jansen:2001b, Loudet:2002}.

We use Pheno2Geno to saturate this genetic map using newly available gene expression data on 
370,000 transcripts measured on 164 individuals from the \emph{A. thaliana} core population. 
Pheno2Geno detects 10.801 phenotypes differentially expressed between parents ($P < 0.01$), from 
which mixture modeling identifies 1230 potential markers showing a 1 to 1 segregation ratio. We 
remove 267 markers which appear to be affected by one or more environments ($LOD >= 7.5$), 
After QTL mapping using the R/qtl \emph{scanone} function 286 candidate markers are removed 
which show none($LOD < 15$) (279 markers) or multiple QTL (7 markers). Scanning for epistasis 
shows 77 candidate markers which appear to show pairwise epistatic interactions ($LOD >= 7.5$). 

Using the remaining 600 candidate markers we saturate the original map, and remove another 103 
duplicate/co-localizing markers. This results in 497 new markers (720\% increase), decreasing 
the average map distance from 7.1 cM to 0.89 cM. Saturation of the \emph{A. thaliana} Bay-0 x 
Sha map led to a more than sevenfold improvement in marker density at no additional lab cost. Map 
distances were re-estimated using Kosambi function. Map expansion is observed on chromosomes 4 
and 5 increasing total map length from 480.7 to 501.5 cM (Fig. 1). 

A \emph{de-novo} reconstruction on gene expression data only (ignoring the original markers and map) 
would have led to a skeleton map containing 227 markers with average distance of 2.2 cM.

QTL mapping of our previously published classical phenotype dataset \cite{Joosen:2011} onto the 
new saturated map leads to an improvement in QTL likelihood for 56\% of previously detected QTLs. 
Additionally, 29 new QTLs are detected as being significant on the saturated map, while showing 
LOD scores close to the threshold when mapped to the original map (between 3.4 to 5 LOD, an 
example is found in Fig. 2).

Moreover, all the gene expression probes showing differential expression between parents (10801 
probes) were scanned. 5837 had a significant ($LOD > 5$) QTL on an original map. 3943 (66\%) 
showed increase in likelihood on a new map(Fig. 3). Additionally, 210 new QTLs are detected as 
being significant on the saturated map.
  
\subsection{Pheno2Geno - Conclusions and Discussion}
Pheno2Geno is the first generic software package for generating genetic markers and maps from 
high-throughput molecular phenotypes for any inbred diploid populations (backcross, F2 intercross 
and recombinant inbred lines). Pheno2Geno selects phenotypes that show multimodal distributions 
with proportions corresponding to expected segregation ratios. When information about environment 
is available, it is used to eliminate markers possibly affected by environment or interaction 
between environment and genotype. Moreover, Pheno2Geno eliminates markers affected by multiple 
QTL or pairwise epistatic interactions between loci.

Pheno2Geno is able to process large volumes of different kinds of molecular phenotypes 
\cite{Trelles:2011}. Computational effort may also be decreased by only selecting phenotypes 
that are different between founders in the first step of the analysis. Memory requirments of the 
algorithm are decreased by reading in and processing files in chunks rather than at once. 
Complete analysis of the showcase data (370,000 transcripts) is performed in matter of hours 
on an average desktop PC (Intel Core i5, 4 GB of RAM). For even larger datasets, the Pheno2Geno 
package is embedded in xQTL workbench \cite{Arends:2012a, arends:2012b} allowing for easy 
parallelization, use of cluster and cloud computing.\newline

Pheno2Geno was developed to improve and facilitate QTL studies. A leading package for QTL mapping 
is R/qtl. Pheno2Geno results are formatted for direct use in R/qtl, providing a smooth transition 
into the QTL mapping phase of the analysis. \newline

In gene expression studies, the molecular phenotypes can show significant major eQTL not only in 
a local eQTL, but also distant eQTLs. In the case of a local eQTL the derived marker will be 
located at the position of the original gene. Often such eQTL are caused by differential signal 
due to polymorphisms in the probe region \cite{Alberts:2005, Alberts:2007}. In the case of a 
distant eQTL the derived marker will not be located by Pheno2Geno at the (possibly known) 
position of the original probe but correctly at the position/region of the distant QTL. \newline

Currently Pheno2Geno uses parental data to reduce the computational burden and to assign the 
parental origin to the mixture-model derived genotype categories in the segregating population. 
When such information is not available, mixture-model based scores cannot be converted into 
scores showing the parental origin (e.g. scores 0 and 1 in RILs cannot be converted into scores 
A and B showing parental origin). Pheno2Geno solves this problem by forming twice as much 
linkage groups as the expected number of chromosomes and then merges anti-correlated pairs 
of linkage groups into a single chromosome. \newline

